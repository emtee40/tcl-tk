package require tcltest 2.2
eval tcltest::configure $argv
tcltest::loadTestedCommands

set tk_strictMotif_old $tk_strictMotif

proc ToPressButton {parent btn} {
	after 100 SendButtonPress $parent $btn
}

proc SendButtonPress {parent btn} {

    set button $::tk::dialog::file::__tk_filedialog($btn\Btn)
    if ![winfo ismapped $button] {
puts "button was not mapped, updating"
        update
    }

    event generate $button <Enter>
    event generate $button <1> -x 5 -y 5
    event generate $button <ButtonRelease-1> -x 5 -y 5
}

array set filters {
    1 {}
    2 {
	{"Text files"		{.txt .doc}	}
	{"Text files"		{}		TEXT}
	{"Tcl Scripts"		{.tcl}		TEXT}
	{"C Source Files"	{.c .h}		}
	{"All Source Files"	{.tcl .c .h}	}
	{"Image Files"		{.gif}		}
	{"Image Files"		{.jpeg .jpg}	}
	{"Image Files"		""		{GIFF JPEG}}
	{"All files"		*}
    }
    3 {
	{"Text files"		{.txt .doc}	TEXT}
	{"Foo"			{""}		TEXT}
    }
}

set tk_strictMotif 1

    set parent .

    ToPressButton $parent cancel
    tk_getOpenFile -parent $parent -filetypes $filters(3)
		    
    ToPressButton $parent cancel
    tk_getSaveFile -parent $parent

set tk_strictMotif $tk_strictMotif_old

#puts "now fixfocus, will crash"
#fixfocus
#puts "returned from fixfocus, didn't crash!"

# cleanup
removeFile filebox.tmp
cleanupTests
return
