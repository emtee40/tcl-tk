package require tcltest 2.2
eval tcltest::configure $argv
tcltest::loadTestedCommands

set tk_strictMotif_old $tk_strictMotif

proc ToPressButton {parent btn} {
    after 100 SendButtonPress $parent $btn
}

proc SendButtonPress {parent btn} {
    set button $::tk::dialog::file::__tk_filedialog($btn\Btn)
    update idletasks
    if ![winfo ismapped $button] {
        puts "button was not mapped, waiting"
        tkwait visibility $::tk::dialog::file::__tk_filedialog($btn\Btn)
    }
    event generate $button <Enter>
    event generate $button <1> -x 5 -y 5
    event generate $button <ButtonRelease-1> -x 5 -y 5
}

set filter {
    {"Text files"		{.txt .doc}	}
    {"Text files"		{}		}
    {"Tcl Scripts"		{.tcl}		}
    {"C Source Files"	{.c .h}		}
    {"All files"		*}
    }

set tk_strictMotif 1

set parent .

#focus -force $parent
puts "Calling tk_getOpenFile -parent $parent -filetypes $filter"
    ToPressButton $parent cancel
    tk_getOpenFile -parent $parent -filetypes $filter
puts "Events call for closure of the tk_getOpenFile dialog"

#focus -force $parent
puts "Calling tk_getSaveFile -parent $parent"
    ToPressButton $parent cancel
    tk_getSaveFile -parent $parent
puts "Events call for closure of the tk_getSaveFile dialog"

set tk_strictMotif $tk_strictMotif_old

# cleanup
removeFile filebox.tmp
cleanupTests
return
